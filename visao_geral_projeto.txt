ğŸ§  DescriÃ§Ã£o Geral do Projeto
Estamos desenvolvendo um servidor WebSocket (WS) responsÃ¡vel por intermediar a comunicaÃ§Ã£o em tempo real entre dois dispositivos envolvidos no fluxo de pagamento de um produto.

Este servidor serÃ¡ responsÃ¡vel por criar uma sala de comunicaÃ§Ã£o exclusiva baseada em um identificador Ãºnico (como o ID do link de pagamento), onde:

Dispositivo 1 Ã© quem inicia o processo e gera o link de pagamento. Ele se conecta ao servidor WS e entra na sala correspondente.

Dispositivo 2 acessa o link (shortlink), entra na aplicaÃ§Ã£o de pagamento e tambÃ©m se conecta Ã  mesma sala. Ele irÃ¡ comunicar eventos importantes e o status final do pagamento ao WS.

O servidor serÃ¡ o responsÃ¡vel por emitir os eventos apropriados ao Dispositivo 1, conforme o Dispositivo 2 progride no fluxo de pagamento.

ğŸ“¦ Objetivos
ComunicaÃ§Ã£o em tempo real entre dois dispositivos usando WebSocket.

Manter uma sala de comunicaÃ§Ã£o por link de pagamento.

Permitir envio de mÃºltiplos eventos do fluxo do pagamento para o Dispositivo 1.

Manter uma estrutura de cÃ³digo modular, limpa e escalÃ¡vel.

Usar somente dependÃªncias necessÃ¡rias, evitando ferramentas pesadas ou complexas.

ğŸ”„ Fluxo de ComunicaÃ§Ã£o
Dispositivo 1:

Gera um link de pagamento (shortlink).

Se conecta ao WS e entra na sala com base no ID do pagamento.

Dispositivo 2:

Acessa o shortlink.

Entra na mesma sala WS.

Durante o fluxo, emite eventos como:

Entrou na tela de resumo.

Clicou em "prosseguir".

Alterou mÃ©todo de pagamento.

Preencheu dados.

Clicou em "pagar".

Status final da API: sucesso ou erro.

O WS envia essas atualizaÃ§Ãµes para o Dispositivo 1 em tempo real.

ğŸ§± Estrutura Sugerida do Projeto
bash
Copiar
Editar
ws-payment-server/
â”œâ”€â”€ app.ts              # Ponto de entrada do servidor WebSocket
â”œâ”€â”€ server.ts           # CriaÃ§Ã£o e inicializaÃ§Ã£o do servidor HTTP + WebSocket
â”œâ”€â”€ rooms.ts            # Gerenciamento de salas e usuÃ¡rios conectados
â”œâ”€â”€ events.ts           # Enum e tipos de eventos WS suportados
â”œâ”€â”€ handlers/
â”‚   â””â”€â”€ paymentFlow.ts  # Handlers dos eventos do fluxo de pagamento
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts        # Tipagens globais para eventos e payloads
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ logger.ts       # FunÃ§Ã£o de log customizada
â”œâ”€â”€ package.json
â””â”€â”€ README.md
âš™ï¸ Tecnologias e DependÃªncias
Node.js

ws (WebSocket nativo e leve)

TypeScript (para escalabilidade e legibilidade)

Nenhuma dependÃªncia desnecessÃ¡ria â€” foco em simplicidade e performance.

âœ… Requisitos TÃ©cnicos
ConexÃ£o com sala baseada no ID do pagamento.

Suporte a mÃºltiplos eventos de fluxo de pagamento.

EmissÃ£o de eventos personalizados do Dispositivo 2 para o Dispositivo 1.

Estrutura robusta e extensÃ­vel para novos eventos.

Logs simples para monitoramento bÃ¡sico do servidor.



--------------------------------------

ğŸ¯ PropÃ³sito Principal
Servidor de comunicaÃ§Ã£o em tempo real para intermediar pagamentos entre dois dispositivos:
Device 1: Gera o link de pagamento e monitora o progresso
Device 2: Processa o pagamento e envia atualizaÃ§Ãµes
ğŸš€ Funcionalidades Core
Sistema de Salas Isoladas
Cada pagamento tem uma sala Ãºnica baseada no roomId
ComunicaÃ§Ã£o isolada e segura entre dispositivos
Limpeza automÃ¡tica de salas vazias
Gerenciamento de ConexÃµes
IdentificaÃ§Ã£o Ãºnica de clientes (clientId)
Suporte a mÃºltiplas conexÃµes simultÃ¢neas
Tratamento de desconexÃµes e reconexÃµes
Fluxo de Pagamento Completo
8 eventos principais do processo de pagamento:
JOIN_ROOM - Entrada na sala
ENTERED_SUMMARY - Entrou no resumo
CLICKED_PROCEED - Clicou em prosseguir
PAYMENT_METHOD_CHANGED - Alterou mÃ©todo
DATA_FILLED - Dados preenchidos
CLICKED_PAY - Clicou em pagar
PAYMENT_SUCCESS - Pagamento aprovado
PAYMENT_ERROR - Erro no pagamento
Sistema de Broadcast
TransmissÃ£o de eventos para todos os clientes na sala
ExclusÃ£o do remetente para evitar loops
ConfirmaÃ§Ãµes de entrega
ğŸ› ï¸ Recursos TÃ©cnicos
Arquitetura Robusta
TypeScript com tipagem forte
Estrutura modular e escalÃ¡vel
Handlers especializados por evento
Monitoramento e Logs
Sistema de logs detalhado
EstatÃ­sticas em tempo real
Rastreamento de conexÃµes e eventos
Tratamento de Erros
ValidaÃ§Ã£o de eventos recebidos
Tratamento de erros de conexÃ£o
Desligamento gracioso do servidor
Performance
Limpeza periÃ³dica de recursos
Gerenciamento eficiente de memÃ³ria
Suporte a ping/pong para manter conexÃµes ativas
ğŸ“Š EstatÃ­sticas DisponÃ­veis
Total de salas ativas
Total de clientes conectados
Detalhes de cada sala (ID, nÃºmero de clientes, data de criaÃ§Ã£o)
ï¿½ï¿½ ConfiguraÃ§Ã£o
Porta configurÃ¡vel (padrÃ£o: 8080)
Suporte a variÃ¡veis de ambiente
Modos de desenvolvimento e produÃ§Ã£o